<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet">

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="keywords" content="Site keywords here">
<meta name="description" content="">
<meta name='copyright' content=''>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<!-- Favicon -->
<link rel="icon" href="img/fav.png">
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" rel="stylesheet">
<link rel="stylesheet" href="all.css">
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="css/bootstrap.min.css">
<!-- Nice Select CSS -->
<link rel="stylesheet" href="css/nice-select.css">
<!-- Font Awesome CSS -->
<link rel="stylesheet" href="css/font-awesome.min.css">
<!-- icofont CSS -->
<link rel="stylesheet" href="css/icofont.css">
<!-- Slicknav -->
<link rel="stylesheet" href="css/slicknav.min.css">
<!-- Owl Carousel CSS -->
<link rel="stylesheet" href="css/owl-carousel.css">
<!-- Datepicker CSS -->
<link rel="stylesheet" href="css/datepicker.css">
<!-- Animate CSS -->
<link rel="stylesheet" href="css/animate.min.css">
<!-- Magnific Popup CSS -->
<link rel="stylesheet" href="css/magnific-popup.css">
<!-- Medipro CSS -->
<link rel="stylesheet" href="css/normalize.css">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="css/chat.css">
<link rel="stylesheet" href="css/responsive.css">  
</head>
<body>
    <header class="header">  
        <div class="topbar">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 col-md-5 col-12">
                        <ul class="top-link">
                            <li><a href="#">العربيه</a></li>
                            <li><a href="#">About</a></li>
                            <li><a href="#">FAQ?</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-6 col-md-7 col-12">
                        <ul class="top-contact">
                            <li><i class="fa fa-envelope"></i><a href="mailto:support@yourmail.com">SmartPatient@gmail.com</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-inner">
            <div class="container">
                <div class="inner">
                    <div class="row">
                        <div class="col-lg-3 col-md-3 col-12">
                            <div class="logo">
                                <a href="Pharmacy Home/Pharmacyhome.html"><img src="img/logo.png" alt="#"></a>
                            </div>
                            <div class="mobile-nav"></div>
                        </div>
                        <div class="col-lg-7 col-md-9 col-12">
                            <div class="main-menu">
                                <nav class="navigation">
                                    <ul class="nav menu">
                                        <li class="active"><a href="index.html">Home<i class="icofont-rounded-down"></i></a>
                                            <ul class="dropdown">
                                                <li><a href="index.html">Home page</a></li>
                                            </ul>
                                        </li>
                                        <li><a href="AboutUs.html">About us</a></li>
                                        <li><a href="contact.html">Contact</a></li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="row clearfix">
            <div class="col-lg-12">
                <div class="card chat-app">
                    <div id="plist" class="people-list">
                        <ul class="list-unstyled chat-list mt-2 mb-0">
                            <li class="clearfix" data-patient="Rana">
                                <img src="img/user.png" alt="avatar">
                                <div class="about">
                                    <div class="name">Rana elbassiony</div>
                                    <div class="status"> <i class="fa fa-circle online"></i> online </div>
                                </div>
                            </li>
                            <li class="clearfix active" data-patient="Nor">
                                <img src="img/user.png">
                                <div class="about">
                                    <div class="name">Nor Wagdy</div>
                                    <div class="status"> <i class="fa fa-circle offline"></i> left 7 mins ago </div>
                                </div>
                            </li>
                            <li class="clearfix" data-patient="Sara">
                                <img src="img/user.png">
                                <div class="about">
                                    <div class="name">Sara elfar</div>
                                    <div class="status"> <i class="fa fa-circle online"></i> online </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="chat">
                        <div class="chat-header clearfix">
                            <div class="row">
                                <div class="col-lg-6">
                                    <a href="javascript:void(0);" data-toggle="modal" data-target="#view_info">
                                        <img id="Patient_Avatar">
                                    </a>
                                    <div class="chat-about">
                                        <h6 class="m-b-0" id="Patient_Name">Nor Wagdy</h6>
                                        <small id="Patient_status">Last seen: 2 hours ago</small>
                                    </div>
                                </div>
                                <div class="col-lg-6 hidden-sm text-right">
                                    <button type="button" class="chatbox-upload-icon btn btn-outline-primary">
                                        <i class='fa fa-image'></i>
                                    </button>
                                    <input type="file" id="imageInput" accept="image/*" style="display: none;">
                                </div>
                            </div>
                        </div>
                        <div class="chat-history">
                            <ul class="m-b-0" id="chat-history">
                            </ul>
                        </div>
                        <div class="chat-message clearfix">
                            <div class="input-group mb-0">
                                <input type="text" id="messageInput" class="form-control" placeholder="Enter text here...">
                                <div class="input-group-append">
                                    <button class="btn btn-primary" id="sendMessage">Send</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        $(document).ready(function() {
            $('.chatbox-upload-icon').on('click', function() {
                $('#imageInput').click();
            });

            $('#imageInput').on('change', function() {
                var file = this.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        var imageUrl = e.target.result;
                        $('#chat-history').append(
                            '<li class="clearfix"><div class="message my-message"><img src="' + imageUrl + '" style="max-width: 200px; max-height: 200px;"></div></li>'
                        );
                    }
                    reader.readAsDataURL(file);
                }
            });

            $('#sendMessage').on('click', function() {
                var message = $('#messageInput').val();
                if (message.trim() !== '') {
                    $('#chat-history').append(
                        '<li class="clearfix"><div class="message my-message">' + message + '</div></li>'
                    );
                    $('.chat-history').scrollTop($('.chat-history')[0].scrollHeight);
                    $('#messageInput').val('');
                }
            });

            // Load default chat on page load
            const defaultPatient = 'Nor';
            updateChatHeader(defaultPatient);
            loadChat(defaultPatient);
        });

        const chats = {
            Rana: [
                {time: "10:10 AM, Today", text: "Do you have Panadol?", from: "other"},
            ],
            Nor: [
                {time: "10:12 AM, Today", text: "I want to ask about specific medicine?", from: "other"},
            ],
            Sara: [
                {time: "11:00 AM, Today", text: "This is my prescription, give me the medicine it contains", from: "other"},
            ],
        };

        function loadChat(patient) {
            const chatHistory = $('#chat-history');
            chatHistory.empty();
            const chatData = chats[patient] || [];
            chatData.forEach(message => {
                if (message.from === 'me' || !message.text.includes('<img')) {
                    const messageClass = message.from === 'me' ? 'my-message' : 'other-message float-right';
                    const messageHtml = `
                        <li class="clearfix">
                            <div class="message-data ${message.from === 'me' ? '' : 'text-right'}">
                                <span class="message-data-time">${message.time}</span>
                            </div>
                            <div class="message ${messageClass}">${message.text}</div>
                        </li>
                    `;
                    chatHistory.append(messageHtml);
                }
            });
            $('.chat-history').scrollTop($('.chat-history')[0].scrollHeight);
        }

        function updateChatHeader(patient) {
            const name = $(`[data-patient=${patient}] .name`).text();
            const status = $(`[data-patient=${patient}] .status`).text();
            const avatar = $(`[data-patient=${patient}] img`).attr('src');
            $('#Patient_Name').text(name);
            $('#Patient_status').text(status);
            $('#Patient_Avatar').attr('src', avatar);
        }

        $(document).ready(function() {
            $('.chat-list li').on('click', function() {
                $('.chat-list li').removeClass('active');
                $(this).addClass('active');
                const patient = $(this).data('patient');
                updateChatHeader(patient);
                loadChat(patient);
            });

            $('#sendMessage').on('click', function() {
                const patient = $('.chat-list li.active').data('patient');
                const message = $('#messageInput').val();
                if (message.trim() !== '') {
                    const newMessage = {time: new Date().toLocaleTimeString(), text: message, from: 'me'};
                    chats[patient].push(newMessage);
                    loadChat(patient);
                    $('#messageInput').val('');
                }
            });

            $('#imageInput').on('change', function() {
                const patient = $('.chat-list li.active').data('patient');
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const newMessage = {
                            time: new Date().toLocaleTimeString(),
                            text: '<img src="' + e.target.result + '" alt="image" style="max-width: 200px;">',
                            from: 'me'
                        };
                        chats[patient].push(newMessage);
                        loadChat(patient);
                    }
                    reader.readAsDataURL(file);
                }
            });
        });
    </script>
</body>
</html>