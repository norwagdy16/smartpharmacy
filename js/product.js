// Sample Product Data 
const productsData = [
    {
        id: 1,
        name: "Mazimal CR",
        category: "Medicine",
        image: "images/maze.jpg",
        price: "10.00 EGP",
         
    },
    {
        id: 2,
        name: "Diabenor",
        category: "Medicine",
        image: "images/diabe.jpg",
        price: "3.00 EGP",
         
    },
    {
        id: 3,
        name: "Cool-Strike",
        category: "Medicine",
        image: "images/cool.png",
        price: "80.00 EGP",
         
    },
    {
        id: 4,
        name: "Dolipran",
        category: "Medicine",
        image: "images/333.jpg",
        price: "40.00 EGP",  
    },
    {
        id: 5,
        name: "B-cor",
        category: "Medicine",
        image: "images/1.jpg",
        price: "11.00 EGP",
         
    },
    {
        id: 6,
        name: "Cataflam",
        category: "Medicine",
        image: "images/7.jpeg",
        price: "62.00 EGP",
         
        
    },
    {
        id: 7,
        name: "Nuzartan",
        category: "Medicine",
        image: "images/4.jpg",
        price: "45.00 EGP",
         
    },
    {
        id: 8,
        name: "Diltiazem",
        category: "Medicine",
        image: "images/3.jpg",
        price: "27.00 EGP",
         
    },
    {
        id: 9,
        name: "Catafast",
        category: "Medicine",
        image: "images/8.jpg",
        price: "51.00 EGP",
         
    },
    {
        id: 10,
        name: "Aspirin",
        category: "Medicine",
        image: "images/asp.jpg",
        price: "20.00 EGP",
         
    },
    {
        id: 11,
        name: "Detronin",
        category: "Medicine",
        image: "images/det.jpg",
        price: "10.00 EGP",
         
    },
    {
        id: 12,
        name: "Epiphenicol",
        category: "Medicine",
        image: "images/epip.jpeg",
        price: "25.00 EGP",
         
    },
    {
        id: 13,
        name: "Euthyrox",
        category: "Medicine",
        image: "images/euth.jpg",
        price: "30.00 EGP",
         
    },
    {
        id: 14,
        name: "Ibuprosol",
        category: "Medicine",
        image: "images/ibu.jpg",
        price: "35.00 EGP",
         
    },
    {
        id: 15,
        name: "Janaglip",
        category: "Medicine",
        image: "images/jana.jpg",
        price: "40 EGP",
         
    },
    {
        id: 16,
        name: "Kefadim",
        category: "Medicine",
        image: "images/kefa.jpg",
        price: "50.00 EGP",
         
    },
    {
        id: 17,
        name: "Repaglinide",
        category: "Medicine",
        image: "images/repa.jpg",
        price: "55.00 EGP",
         
    },
    {
        id: 18,
        name: "Panadol Joint",
        category: "Medicine",
        image: "images/pan2.jpg",
        price: "45.00 EGP",
         
    },
    {
        id: 19,
        name: "Panadol Extra",
        category: "Medicine",
        image: "images/1.png",
        price: "37.00 EGP",
    },
    {
        id: 20,
        name: "vaxato",
        category: "Medicine",
        image: "images/vaxa.jpg",
        price: "33.00 EGP",
         
    },
    {
        id: 21,
        name: "Panadol Advance",
        category: "Medicine",
        image: "images/ban.jpg",
        price: "44.00 EGP",
    },

    {
        id: 22,
        name: "Maybelline",
        category: "Make up",
        image: "images/88.jpg",
        price: "278.00 EGP",
         
    },
    {
        id: 23,
        name: "Foundation",
        category: "Make up",
        image: "images/cc.jpg",
        price: "344.00 EGP",
         
    },
    {
        id: 24,
        name: "Rare Beauty",
        category: "Make up",
        image: "images/d.jpg",
        price: "1500.00 EGP",
         
    },
    {
        id: 25,
        name: "Amanda",
        category: "Make up",
        image: "images/amanda.jpg",
        price: "200.00 EGP",
         
    },
    {
        id: 26,
        name: "SheGlam",
        category: "Make up",
        image: "images/blusher.jpg",
        price: "300.00 EGP",
         
    },
    {
        id: 27,
        name: "Note",
        category: "Make up",
        image: "images/blush.jpg",
        price: "350.00 EGP",
         
    },
    {
        id: 28,
        name: "Consealer",
        category: "Make up",
        image: "images/n.jpg",
        price: "222.00 EGP",
         
    },
    {
        id: 29,
        name: "SheGlam Consealer",
        category: "Make up",
        image: "images/cons.jpg",
        price: "333.00 EGP",
         
    },
    {
        id: 30,
        name: "Contor",
        category: "Make up",
        image: "images/contor.jpg",
        price: "250.00 EGP",
         
    },
    {
        id: 31,
        name: "Lip Linear",
        category: "Make up",
        image: "images/liner.jpg",
        price: "150.00 EGP",
         
    },
    {
        id: 32,
        name: " Lip Linear Kit",
        category: "Make up",
        image: "images/liner1.jpg",
        price: "230.00 EGP",
         
    },
    {
        id: 33,
        name: "Lip Gloss",
        category: "Make up",
        image: "images/lip.jpg",
        price: "255.00 EGP",
         
    },
    {
        id: 34,
        name: "Lipstick",
        category: "Make up",
        image: "images/lip1.jpg",
        price: "280.00 EGP",
         
    },
    {
        id: 35,
        name: "Max Factor",
        category: "Make up",
        image: "images/max factor.jpg",
        price: "500.00 EGP",
         
    },
    {
        id: 36,
        name: "HighLighter",
        category: "Make up",
        image: "images/mitecinam.jpg",
        price: "370.00 EGP",
         
    },
    {
        id: 37,
        name: "Powder",
        category: "Make up",
        image: "images/powder.jpg",
        price: "444.00 EGP",
         
    },
    {
        id: 40,
        name: "Essence",
        category: "Make up",
        image: "images/powder1.jpg",
        price: "302.00 EGP",
         
    },
    {
        id: 41,
        name: "Primer",
        category: "Make up",
        image: "images/primer.jpg",
        price: "210.00 EGP",
         
    },
    {
        id: 42,
        name: "Rare Beauty Mascara",
        category: "Make up",
        image: "images/e.jpg",
        price: "2200.00 EGP",
         
    },

{
        id: 43,
        name: "La Roche Posay",
        category: "Skincare Product",
        image: "images/p.jpg",
        price: "600.00 EGP",
         
    },
    {
        id: 44,
        name: "Clean&Clear",
        category: "Skincare Product",
        image: "images/11.png",
        price: "200.00 EGP",
         
    },
    {
        id: 45,
        name: "Vichy",
        category: "Skincare Product",
        image: "images/33.png",
        price: "700.00 EGP",
         
    },
    {
        id: 46,
        name: "Vasline",
        category: "Skincare Product",
        image: "images/vas1.jpg",
        price: "800.00 EGP",
         
    },
    {
        id: 47,
        name: "The Ordinary",
        category: "Skincare Product",
        image: "images/66.png",
        price: "1400.00 EGP",  
    },
    {
        id: 48,
        name: "Vichy Mineral",
        category: "Skincare Product",
        image: "images/10.jpg",
        price: "888.00 EGP",
         
    },
    {
        id: 49,
        name: "Tom Ford",
        category: "Skincare Product",
        image: "images/11.jpeg",
        price: "444.00 EGP",
         
    },
    {
        id: 50,
        name: "La Roche Toleriane",
        category: "Skincare Product",
        image: "images/66.jpg",
        price: "900.00 EGP",
         
    },
    {
        id: 51,
        name: "CeraVE",
        category: "Skincare Product",
        image: "images/77.jpg",
        price: "600.00 EGP",
         
    },
    {
        id: 52,
        name: "La Roche Cleanser",
        category: "Skincare Product",
        image: "images/99.jpg",
        price: "1000.00 EGP",
         
    },
    {
        id: 53,
        name: "Vasline Lip ",
        category: "Skincare Product",
        image: "images/vas2.jpg",
        price: "250.00 EGP",
         
    },

    {
        id: 54,
        name: "North For Men",
        category: "Men Product",
        image: "images/6.jpeg",
        price: "300.00 EGP",
         
    },
    {
        id: 55,
        name: "Marbele",
        category: "Men Product",
        image: "images/9.jpeg",
        price: "400.00 EGP",
         
    },
    {
        id: 56,
        name: "Hair Remover",
        category: "Men Product",
        image: "images/101.jpg",
        price: "450.00 EGP",
         
    },
    {
        id: 57,
        name: "Hair Remover",
        category: "Men Product",
        image: "images/max.jpg",
        price: "600.00 EGP",
         
    },
    {
        id: 58,
        name: "North 3 in 1",
        category: "Men Product",
        image: "images/5.jpeg",
        price: "700.00 EGP",
         
    },
    {
        id: 59,
        name: "North Soap Bar",
        category: "Men Product",
        image: "images/men.jpg",
        price: "350.00 EGP",
         
    },
    {
        id: 60,
        name: "Gillette",
        category: "Men Product",
        image: "images/mn2.jpeg",
        price: "400.00 EGP",
         
    },
    {
        id: 61,
        name: "Gillette Kit",
        category: "Men Product",
        image: "images/mn1.jpeg",
        price: "555.00 EGP",
         
    },
    {
        id: 62,
        name: "Nivea",
        category: "Men Product",
        image: "images/mn12.jpeg",
        price: "700.00 EGP",
         
    },


    {
        id: 63,
        name: "Shampoo",
        category: "Hair Product",
        image: "images/55.png",
        price: "150.00 EGP",
         
    },
    {
        id: 64,
        name: "Bless",
        category: "Hair Product",
        image: "images/555.jpg",
        price: "120.00 EGP",
         
    },
    {
        id: 65,
        name: "Clary",
        category: "Hair Product",
        image: "images/b.jpg",
        price: "299.00 EGP",
         
    },
    {
        id: 66,
        name: "Dermomde",
        category: "Hair Product",
        image: "images/derm1.jpg",
        price: "70.00 EGP",
         
    },
    {
        id: 67,
        name: "Pantene",
        category: "Hair Product",
        image: "images/pan.jpg",
        price: "200.00 EGP",
         
    },
    {
        id: 68,
        name: "HairDO",
        category: "Hair Product",
        image: "images/hairdo.jpeg",
        price: "250.00 EGP",
         
    },
    {
        id: 69,
        name: "Enliven",
        category: "Hair Product",
        image: "images/elevn.jpg",
        price: "400.00 EGP",
         
    },
    {
        id: 70,
        name: "Herbal",
        category: "Hair Product",
        image: "images/herbal.jpg",
        price: "210.00 EGP",
         
    },
    {
        id: 71,
        name: "Ever Pure Shampo",
        category: "Hair Product",
        image: "images/ever1.jpg",
        price: "340.00 EGP",
         
    },


    {
        id: 72,
        name: "Sanosan",
        category: "Baby Essentials",
        image: "images/77.png",
        price: "425.00 EGP",
         
    },
    {
        id: 73,
        name: "Gohnsons",
        category: "Baby Essentials",
        image: "images/5.jpg",
        price: "69.00 EGP",
         
    },
    {
        id: 74,
        name: "Sudocream",
        category: "Baby Essentials",
        image: "images/88.png",
        price: "380.00 EGP",
    },
    {
        id: 75,
        name: "Gohnsons Baby jelly",
        category: "Baby Essentials",
        image: "images/bab.jpg",
        price: "105.00 EGP", 
    },
    {
        id: 76,
        name: "Baby Cream",
        category: "Baby Essentials",
        image: "images/dr.jpg",
        price: "218.00 EGP",  
    },
    {
        id: 77,
        name: "Eva Baby Oil",
        category: "Baby Essentials",
        image: "images/baby.jpg",
        price: "74.00 EGP",
    },
    {
        id: 78,
        name: "Fine",
        category: "Baby Essentials",
        image: "images/fine.jpg",
        price: "428.00 EGP",
         
    },
    {
        id: 79,
        name: "I Care",
        category: "Baby Essentials",
        image: "images/icare1.jpg",
        price: "48.00 EGP",
         
    },
    {
        id: 80,
        name: "Super Kides",
        category: "Baby Essentials",
        image: "images/kids.jpeg",
        price: "79.00 EGP",
         
    },
    {
        id: 81,
        name: "MamaEarth",
        category: "Baby Essentials",
        image: "images/mama.jpg",
        price: "219.00 EGP",
         
    },
    {
        id: 82,
        name: "Nunu Babay cologne",
        category: "Baby Essentials",
        image: "images/nono.jpeg",
        price: "56.00 EGP",
         
    },
    {
        id: 83,
        name: "Nunu Babay Shampo",
        category: "Baby Essentials",
        image: "images/no sh.jpeg",
        price: "210.00 EGP",
         
    },
    {
        id: 84,
        name: "Penduline",
        category: "Baby Essentials",
        image: "images/pend.jpeg",
        price: "81.00 EGP",
         
    },
    {
        id: 85,
        name: "Sanosan",
        category: "Baby Essentials",
        image: "images/senso.jpg",
        price: "633.00 EGP",
         
    },
    {
        id: 86,
        name: "Gohnsons Lotion",
        category: "Baby Essentials",
        image: "images/lotion.jpeg",
        price: "49.00 EGP",
         
    },
    {
        id: 87,
        name: "Gohnsons lotion2",
        category: "Baby Essentials",
        image: "images/shampo.jpg",
        price: "50.00 EGP",
         
    },
    {
        id: 88,
        name: "Vatika Baby Oil",
        category: "Baby Essentials",
        image: "images/vatika1.jpg",
        price: "32.00 EGP",
         
    },
    {
        id: 89,
        name: "Tola Kids",
        category: "Baby Essentials",
        image: "images/tola1.jpg",
        price: "118.00 EGP",
         
    },
    {
        id: 90,
        name: "Toffee Kids",
        category: "Baby Essentials",
        image: "images/toffee.jpg",
        price: "77.00 EGP",
         
    },

  
];
let cart = JSON.parse(localStorage.getItem("cart")) || [];

document.addEventListener("DOMContentLoaded", function () {
    renderProducts(productsData);
    updateCartCount();
    setupSearch();
});

function renderProducts(products) {
    const productsContainer = document.getElementById("products");
    productsContainer.innerHTML = "";
    
    const lastProducts = {};
    products.forEach(product => {
        lastProducts[product.category] = product;
    });

    products.forEach(product => {
        const inCart = cart.some(cartProduct => cartProduct.id === product.id);
        const isLastInCategory = lastProducts[product.category].id === product.id;
        
        const productCard = `
        <div class="product" data-id="${product.id}" data-name="${product.name}" data-image="${product.image}" data-description="${product.description}" data-price="${product.price}">
            <a href="#" target="_blank"><img src="${product.image}" alt="${product.name}"></a>
            <h3>${product.name}</h3>
            <p class="price">${product.price}</p>
            <button class="add-to-cart ${isLastInCategory ? 'last-in-category' : ''}" data-id="${product.id}" ${inCart ? 'disabled class="added"' : ''}>${inCart ? 'Sold Out' : 'Add to Cart'}</button>
        </div>`;
        
        productsContainer.innerHTML += productCard;
    });
    updateCartUI();
}

const categoryItems = document.querySelectorAll("#product-categories li");
categoryItems.forEach(item => {
    item.addEventListener("click", () => {
        categoryItems.forEach(el => el.classList.remove("active"));
        item.classList.add("active");
        const category = item.getAttribute("data-filter");
        const filteredProducts = category === "all" ? productsData : productsData.filter(product => product.category === category);
        renderProducts(filteredProducts);
    });
});

function updateCartUI() {
    const addToCartButtons = document.querySelectorAll(".add-to-cart");

    addToCartButtons.forEach(button => {
        const productId = parseInt(button.getAttribute("data-id"));
        const inCart = cart.some(product => product.id === productId);

        // Remove any existing event listeners
        const newButton = button.cloneNode(true);
        button.parentNode.replaceChild(newButton, button);

        if (inCart) {
            newButton.textContent = "Added";
            newButton.classList.add("added");
            newButton.disabled = true;
        } else if (newButton.classList.contains("last-in-category")) {
            newButton.addEventListener("click", function() {
                newButton.textContent = "Sold Out";
                newButton.classList.add("sold-out");
                newButton.style.backgroundColor = "red";
                newButton.disabled = true;
            });
        } else {
            newButton.addEventListener("click", function() {
                const product = productsData.find(product => product.id === productId);
                if (!cart.some(cartProduct => cartProduct.id === productId)) {
                    cart.push(product);
                    localStorage.setItem("cart", JSON.stringify(cart));
                    updateCartCount();
                    updateCartUI();
                }
            });
        }
    });
}

function updateCartCount() {
    document.getElementById("cart-count").textContent = cart.length;
}

function setupSearch() {
    const searchInput = document.getElementById("searchInput");
    searchInput.addEventListener("input", function() {
        const searchTerm = searchInput.value.trim().toLowerCase();
        const currentCategory = document.querySelector("#product-categories li.active").getAttribute("data-filter");
        let filteredProducts;

        // Check if search term has at least three characters before filtering
        if (searchTerm.length >= 3) {
            if (currentCategory === "all") {
                filteredProducts = productsData.filter(product => product.name.toLowerCase().includes(searchTerm));
            } else {
                filteredProducts = productsData.filter(product => product.name.toLowerCase().includes(searchTerm) && product.category === currentCategory);
            }

            if (filteredProducts.length > 0) {
                renderProducts(filteredProducts);
            } else {
                renderSoldOutMessage();
            }
        } else {
            // If search term is less than three characters, do not perform search
            renderProducts(productsData); // Render all products
        }
    });
}

function renderSoldOutMessage() {
    const productsContainer = document.getElementById("products");
    productsContainer.innerHTML = "<p>Sold Out</p>";
}






